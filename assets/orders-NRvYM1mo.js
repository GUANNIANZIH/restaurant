import{_ as I,a0 as B,r as A,c as N,o as a,b as O,w as l,d as n,e as P,W as p,f as o,g as k,F as f,V,X as x,a6 as $,Y as u,a9 as i,Z as q,$ as F}from"./index-DBGRXxQO.js";import{b as v}from"./route-block-B_A1xBdJ.js";import{V as L,a as w}from"./VCol-Dq0c6NTT.js";import{V as T}from"./VDivider-jijU4NhG.js";import{V as j}from"./VDataTable-ChnC5vvV.js";import{V as E}from"./VRow-CFjxX7wx.js";import"./VPagination-CzyIzGEc.js";import"./VSelect-BGaOzG2Z.js";import"./VList-D6pbzkQD.js";import"./ssrBoot-Dzf-mmbx.js";import"./VSlideGroup-tKjpEM-X.js";const R=d=>(q("data-v-0520ba56"),d=d(),F(),d),W=R(()=>p("h1",{class:"text-center text-cus"},"即時點餐訂單管理",-1)),X={key:0},Y={key:0},Z={key:1},G={key:2},H={key:3},J={key:4},K={key:1},C={__name:"orders",setup(d){const{apiAuth:_}=$(),m=B(),y=A([]),z=[{title:"訂單編號",key:"_id"},{title:"會員帳號",key:"user.account"},{title:"下單日期",key:"createdAt",value:s=>new Date(s.createdAt).toLocaleString()},{title:"訂單商品",key:"cart",sortable:!1},{title:"客製化需求",key:"customized",sortable:!1},{title:"訂單金額",key:"price",value:s=>s.cart.reduce((c,e)=>c+e.quantity*e.p_id.price,0)},{title:"訂單狀態",key:"status",sortable:!1}],h=async()=>{var s,c;try{const{data:e}=await _.get("/order/all");y.value.push(...e.result)}catch(e){console.log(e),m({text:((c=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:c.message)||"發生錯誤",snackbarProps:{color:"red"}})}};h();const b=async(s,c)=>{var e,t;try{console.log(_.defaults),console.log({_id:s._id,status:c}),console.log("Changing status to:",c),console.log(s._id),console.log(s.status);const{data:r}=await _.patch("/order/all",{_id:s._id,status:c});m({text:r.message,snackbarProps:{color:"#3C5D44"}}),h()}catch(r){console.log(r),m({text:((t=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}},S=async s=>{await b(s,"canceled")},g=s=>["completed","canceled"].includes(s),D=N(()=>y.value.slice().sort((s,c)=>{const e=["in-process","completed","canceled","canceled"];return e.indexOf(s.status)-e.indexOf(c.status)}));return(s,c)=>(a(),O(L,null,{default:l(()=>[n(E,null,{default:l(()=>[n(w,{cols:"12"},{default:l(()=>[W]),_:1}),n(T),n(w,{cols:"12",class:"h-75"},{default:l(()=>[n(j,{items:P(D),headers:z,"items-per-page":4,"items-per-page-options":[4,8,12]},{"item.cart":l(e=>[p("ul",null,[(a(!0),o(f,null,k(e.item.cart,t=>(a(),o("li",{key:t._id},u(t.p_id.name)+" * "+u(t.quantity),1))),128))])]),"item.customized":l(e=>[p("ul",null,[(a(!0),o(f,null,k(e.item.cart,t=>(a(),o("li",{key:t._id},[Object.keys(t.customizations).length?(a(),o("ul",X,[t.customizations.加辣?(a(),o("li",Y,"辣度: "+u(t.customizations.加辣),1)):i("",!0),t.customizations["加蛋 +15"]==="true"?(a(),o("li",Z,"加蛋 +15")):i("",!0),t.customizations["加飯 +15"]==="true"?(a(),o("li",G,"加飯 +15")):i("",!0),t.customizations["加沙茶 +15"]==="true"?(a(),o("li",H,"加沙茶 +15")):i("",!0),t.customizations["加料 +45"]==="true"?(a(),o("li",J,"加料 +45")):i("",!0)])):(a(),o("span",K,"無"))]))),128))])]),"item.status":l(({item:e})=>[p("div",null,[(a(),o(f,null,k(["in-process","completed"],t=>n(V,{key:t,onClick:r=>b(e,t),class:"mt-2 mb-2 w-75 bg-dark",disabled:g(e.status)},{default:l(()=>[x(u(t),1)]),_:2},1032,["onClick","disabled"])),64)),n(V,{title:"canceled",onClick:t=>S(e),class:"mt-2 mb-2 w-75 bg-er",disabled:g(e.status)},{default:l(()=>[x("canceled")]),_:2},1032,["onClick","disabled"])])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}))}};typeof v=="function"&&v(C);const ne=I(C,[["__scopeId","data-v-0520ba56"]]);export{ne as default};
