import{a0 as Q,r as u,a as W,o as q,f as X,d as t,w as r,a5 as Y,F as G,a6 as Z,V as g,X as A,aL as F,aQ as _,as as ee,b as ae,a9 as te,aR as le,e as o,aN as oe,aK as se,Y as re,a3 as ne,a4 as ue,W as ie,J as de}from"./index-CryKp6Ly.js";import{c as me,a as D,b as ve,u as pe,d as c,V as ge}from"./vee-validate.esm-BqZoza1p.js";import{b as K}from"./route-block-B_A1xBdJ.js";import{V as ce,a as M}from"./VCol-BP2HWyMW.js";import{V as be}from"./VRow-BhoZUXlw.js";import{V as fe}from"./VDataTableServer-BA4R8S36.js";import{V as Ve}from"./VTextarea-DlGlBtWY.js";import{V as ye}from"./VSelect-_x5t2RBi.js";import{V as ke}from"./VCheckbox-B5TwZNH2.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-CNud02Rd.js";import"./VPagination-DzWpZ6cF.js";import"./VDivider-CV8ah_1I.js";import"./VList-WWYH1D95.js";import"./ssrBoot-CQ6XiwJX.js";import"./VSlideGroup-DANVPriE.js";const we=ie("h1",{class:"text-center"},"活動資訊管理頁面",-1),xe={__name:"news",setup(Ce){const{apiAuth:b}=Z(),p=Q(),I=u(null),n=u({open:!1,id:""}),h=l=>{l?(n.value.id=l._id,f.value.value=l.title,V.value.value=l.subtitle,y.value.value=l.content,k.value.value=l.category,w.value.value=l.isPublished):n.value.id="",n.value.open=!0},T=()=>{n.value.open=!1,H(),I.value.deleteFileRecord()},z=async l=>{var e;try{await b.delete(`/news/${l._id}`),p({text:"新增貼文已刪除",color:"success"}),d(!0)}catch(i){p({text:((e=i.response)==null?void 0:e.data.message)||"刪除失敗",color:"error"})}},L=["新品上市","店休公告","會員活動"],j=me({title:D().required("公告標題必填"),subtitle:D(),content:D().required("公告內容必填"),category:D().required("文章種類必填").test("isCategory","文章種類錯誤",l=>L.includes(l)),isPublished:ve()}),{handleSubmit:E,isSubmitting:S,resetForm:H}=pe({validationSchema:j,initialValues:{title:"",subtitle:"",content:"",category:"",isPublished:!0}}),f=c("title"),V=c("subtitle"),y=c("content"),k=c("category"),w=c("isPublished"),v=u([]),N=u([]),J=E(async l=>{var e,i,a;if(!((e=v.value[0])!=null&&e.error)&&!(n.value.id.length===0&&v.value.length<1))try{const s=new FormData;s.append("title",l.title),s.append("subtitle",l.subtitle),s.append("content",l.content),s.append("category",l.category),s.append("isPublished",l.isPublished),v.value.length>0&&s.append("image",v.value[0].file),n.value.id===""?await b.post("/news",s):await b.patch("/news/"+n.value.id,s),p({text:n.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"#D78A24"}}),T(),d(!0)}catch(s){console.log(s),p({text:((a=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"#D66425"}})}}),U=u(10),x=u([{key:"createdAt",order:"desc"}]),C=u(1),$=u([]),O=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"標題",align:"center",sortable:!0,key:"title"},{title:"副標題",align:"center",sortable:!0,key:"subtitle"},{title:"內容",align:"center",sortable:!0,key:"content"},{title:"下單日期",key:"createdAt",value:l=>new Date(l.createdAt).toLocaleString()},{title:"種類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"isPublished"},{title:"操作",align:"center",sortable:!1,key:"action"}],B=u(!0),R=u(0),P=u(""),d=async l=>{var e,i,a,s;l&&(C.value=1),B.value=!0;try{const{data:m}=await b.get("/news/all",{params:{page:C.value,itemsPerPage:U.value,sortBy:((e=x.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((i=x.value[0])==null?void 0:i.order)||"desc",search:P.value}});$.value.splice(0,$.value.length,...m.result.data),R.value=m.result.total}catch(m){console.log(m),p({text:((s=(a=m==null?void 0:m.response)==null?void 0:a.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}B.value=!1};return d(),(l,e)=>{const i=W("vue-file-agent");return q(),X(G,null,[t(ce,null,{default:r(()=>[t(be,null,{default:r(()=>[t(M,{cols:"12"},{default:r(()=>[we]),_:1}),t(M,{cols:"12"},{default:r(()=>[t(g,{color:"#3C5D44",onClick:e[0]||(e[0]=a=>h(null))},{default:r(()=>[A("建立活動資訊")]),_:1})]),_:1}),t(M,{cols:"12"},{default:r(()=>[t(fe,{"items-per-page":U.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>U.value=a),e[7]||(e[7]=a=>d(!1))],"sort-by":x.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>x.value=a),e[8]||(e[8]=a=>d(!1))],page:C.value,"onUpdate:page":[e[6]||(e[6]=a=>C.value=a),e[9]||(e[9]=a=>d(!1))],items:$.value,headers:O,loading:B.value,"items-length":R.value,search:P.value,hover:""},{top:r(()=>[t(F,{label:"搜尋",modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value=a),"append-icon":"mdi-magnify",onClickAppend:e[2]||(e[2]=a=>d(!0)),onKeydown:e[3]||(e[3]=_(a=>d(!0),["enter"]))},null,8,["modelValue"])]),"item.image":r(({value:a})=>[t(ee,{src:a,height:"50px"},null,8,["src"])]),"item.isPublished":r(({value:a})=>[a?(q(),ae(de,{key:0,icon:"mdi-check"})):te("",!0)]),"item.action":r(({item:a})=>[t(g,{icon:"mdi-pencil",variant:"text",color:"#3C5D44",onClick:s=>h(a)},null,8,["onClick"]),t(g,{icon:"mdi-delete",variant:"text",color:"#D78A24",onClick:s=>z(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(Y,{modelValue:n.value.open,"onUpdate:modelValue":e[17]||(e[17]=a=>n.value.open=a),persistent:"",width:"500"},{default:r(()=>[t(ge,{onSubmit:le(o(J),["prevent"]),disabled:o(S)},{default:r(()=>[t(oe,null,{default:r(()=>[t(se,null,{default:r(()=>[A(re(n.value.id?"編輯活動":"新增活動"),1)]),_:1}),t(ne,null,{default:r(()=>[t(F,{label:"名稱",modelValue:o(f).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>o(f).value.value=a),"error-messages":o(f).errorMessage.value},null,8,["modelValue","error-messages"]),t(F,{label:"副標題",modelValue:o(V).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>o(V).value.value=a),"error-messages":o(V).errorMessage.value},null,8,["modelValue","error-messages"]),t(Ve,{label:"文案內容",modelValue:o(y).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>o(y).value.value=a),"error-messages":o(y).errorMessage.value},null,8,["modelValue","error-messages"]),t(ye,{label:"文章種類",items:L,modelValue:o(k).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>o(k).value.value=a),"error-messages":o(k).errorMessage.value},null,8,["modelValue","error-messages"]),t(ke,{label:"發布文章",modelValue:o(w).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>o(w).value.value=a),"error-messages":o(w).errorMessage.value},null,8,["modelValue","error-messages"]),t(i,{modelValue:v.value,"onUpdate:modelValue":e[15]||(e[15]=a=>v.value=a),"raw-model-value":N.value,"onUpdate:rawModelValue":e[16]||(e[16]=a=>N.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"3MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 3MB"},ref_key:"fileAgent",ref:I},null,8,["modelValue","raw-model-value"])]),_:1}),t(ue,null,{default:r(()=>[t(g,{color:"red",loading:o(S),onClick:T},{default:r(()=>[A("取消")]),_:1},8,["loading"]),t(g,{color:"#D78A24",type:"submit",loading:o(S)},{default:r(()=>[A("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof K=="function"&&K(xe);export{xe as default};
