import{a0 as L,u as U,r as b,o as n,b as j,w as e,d as t,W as _,f as u,F,g as Y,X as h,Y as d,a9 as C,a6 as E,b5 as G,c as N,a2 as H,V as w,aN as T,as as tt,aK as K,aO as X,e as A,a3 as et,J as z}from"./index-Bu-L9tWe.js";import{V as M}from"./VRow-Dii2Aylt.js";import{a as $,V as J}from"./VCol-2N5JWqBX.js";import{V as Q}from"./VDivider-BywbZaXj.js";import{V as O}from"./VDataTable-DOEYLjcE.js";import{V as B}from"./VSheet-BAjgFa33.js";import{a as P,V as at,c as I,b as st}from"./VTabs-DF7luKP4.js";import"./VPagination-PY4KUWDM.js";import"./VSelect-B2wmCXsy.js";import"./VList-Cuksv22t.js";import"./ssrBoot-BfmUi3OG.js";import"./VSlideGroup-Cxs4FCQ-.js";import"./VWindowItem-Cyb4wyKo.js";const lt=""+new URL("玉食堂會員卡-6bfaCLpA.png",import.meta.url).href,ot=_("h2",{class:"text-center"},"我的訂單查詢",-1),nt={key:0},ct={key:1},it={key:2},rt={key:3},ut={key:4},dt={__name:"profileOrder_dataTable",setup(R){const{apiAuth:v}=E(),V=L();U();const y=b([]),x=[{title:"編號",key:"_id"},{title:"日期",key:"createdAt",value:r=>new Date(r.createdAt).toLocaleString()},{title:"商品",key:"cart",sortable:!1},{title:"金額",key:"price",value:r=>r.cart.reduce((m,a)=>m+a.quantity*a.p_id.price,0)}];return(async()=>{var r,m;try{const{data:a}=await v.get("/order");if(a.success)y.value.push(...a.result);else throw new Error(a.message||"無法加載訂單資料")}catch(a){console.error("Error loading orders:",{message:a.message,stack:a.stack,response:a.response}),V({text:((m=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:m.message)||"發生錯誤，無法加載訂單資料",snackbarProps:{color:"red"}})}})(),(r,m)=>(n(),j(J,null,{default:e(()=>[t(M,null,{default:e(()=>[t($,{cols:"12"},{default:e(()=>[ot]),_:1}),t(Q),t($,{cols:"12"},{default:e(()=>[t(O,{items:y.value,headers:x},{"item.cart":e(a=>[_("ul",null,[(n(!0),u(F,null,Y(a.item.cart,p=>(n(),u("li",{key:p._id},[h(d(p.p_id.name)+" * "+d(p.quantity)+" ",1),_("ul",null,[p.customizations.加辣?(n(),u("li",nt,"辣度: "+d(p.customizations.加辣),1)):C("",!0),p.customizations["加蛋 +15"]==="true"?(n(),u("li",ct,"加蛋 +15")):C("",!0),p.customizations["加飯 +15"]==="true"?(n(),u("li",it,"加飯 +15")):C("",!0),p.customizations["加沙茶 +15"]==="true"?(n(),u("li",rt,"加沙茶 +15")):C("",!0),p.customizations["加料 +45"]==="true"?(n(),u("li",ut,"加料 +45")):C("",!0)])]))),128))])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}))}},_t=_("h2",{class:"text-center"},"我的私廚訂單查詢",-1),pt={__name:"profileOrderSpecialty_dataTable",setup(R){const{apiAuth:v}=E(),V=L();U();const y=b([]),x=[{title:"編號",key:"_id"},{title:"日期",key:"createdAt",value:r=>new Date(r.createdAt).toLocaleString()},{title:"商品",key:"cartSpecialties",sortable:!1},{title:"金額",key:"price",value:r=>r.cartSpecialties.reduce((m,a)=>m+a.quantity*a.p_id.price,0)}];return(async()=>{var r,m;try{const{data:a}=await v.get("/order/specialty");y.value.push(...a.result)}catch(a){console.log(a),V({text:((m=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:m.message)||"發生錯誤",snackbarProps:{color:"red"}})}})(),(r,m)=>(n(),j(J,null,{default:e(()=>[t(M,null,{default:e(()=>[t($,{cols:"12"},{default:e(()=>[_t]),_:1}),t(Q),t($,{cols:"12"},{default:e(()=>[t(O,{items:y.value,headers:x},{"item.cartSpecialties":e(a=>[_("ul",null,[(n(!0),u(F,null,Y(a.item.cartSpecialties,p=>(n(),u("li",{key:p._id},d(p.p_id.name)+" * "+d(p.quantity),1))),128))])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}))}},mt=_("h2",{class:"text-center"},"我的預購私廚購物車",-1),ft={key:0},yt={key:1,class:"text-red"},kt={__name:"cartSpecialty",setup(R){const{apiAuth:v}=E(),V=G(),y=L(),x=U(),i=b([]),r=[{title:"品名",key:"p_id.name"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:c=>c.p_id.price*c.quantity},{title:"操作",key:"action"}],m=async()=>{var c,k;try{const{data:o}=await v.get("/user/cartSpecialty");i.value=o.result}catch(o){console.log(o),y({text:((k=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:k.message)||"發生錯誤",snackbarProps:{color:"#D78A24"}})}};m();const a=N(()=>i.value.reduce((c,k)=>c+k.quantity*k.p_id.price,0)),p=N(()=>i.value.length>0&&!i.value.some(c=>!c.p_id.sell)),q=b(!1),W=async()=>{q.value=!0;const c=await x.checkoutSpecialty();y({text:c.text,snackbarProps:{color:c.color}}),c.color==="#3C5D44"&&V.push("/"),q.value=!1},D=async(c,k)=>{const o=await x.addSpecialtyCart(c,k);if(y({text:o.text,snackbarProps:{color:o.color}}),o.color==="#3C5D44"){const g=i.value.findIndex(l=>l.p_id._id===c);i.value[g].quantity+=k,i.value[g].quantity<=0&&i.value.splice(g,1)}};return H(()=>{m()}),(c,k)=>(n(),u(F,null,[t(T,null,{default:e(()=>[t(B,{cols:"12",class:"ma-5 text-center"},{default:e(()=>[mt]),_:1}),t(O,{items:i.value,headers:r},{"item.p_id.name":e(({item:o})=>[o.p_id.sell?(n(),u("span",ft,d(o.p_id.name),1)):(n(),u("span",yt,d(o.p_id.name)+" (已下架)",1))]),"item.quantity":e(({item:o})=>[t(w,{variant:"text",color:"red",onClick:g=>D(o.p_id._id,-1)},{default:e(()=>[h("-")]),_:2},1032,["onClick"]),_("span",null,d(o.quantity),1),t(w,{variant:"text",color:"green",onClick:g=>D(o.p_id._id,1)},{default:e(()=>[h("+")]),_:2},1032,["onClick"])]),"item.action":e(({item:o})=>[t(w,{variant:"text",color:"#D78A24",icon:"mdi-delete",onClick:g=>D(o.p_id._id,o.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),t(B,{class:"ma-5 text-center"},{default:e(()=>[_("p",null,"總金額: "+d(a.value),1),t(w,{color:"#3C5D44",disabled:!p.value,onClick:W},{default:e(()=>[h("結帳")]),_:1},8,["disabled"])]),_:1})],64))}},ht=_("span",null,"即時餐點購物車",-1),vt=_("span",null,"預購私廚購物車",-1),xt=_("span",null,"即時餐點訂單查詢",-1),Ct=_("span",null,"私廚訂單查詢",-1),bt=_("h2",{class:"text-center"},"我的即時餐點購物車",-1),Vt={key:0},gt={key:1,class:"text-red"},wt={key:0},St={key:1},$t={key:2},qt={key:3},Dt={key:4},jt={__name:"profile",setup(R){const v=b(1),{apiAuth:V}=E(),y=G(),x=L(),i=U(),r=b(0),m=b(0),a=b([]),p=[{title:"品名",key:"p_id.name"},{title:"客製化需求",key:"customized"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:l=>l.p_id.price*l.quantity},{title:"操作",key:"action"}],q=async()=>{var l,f;try{const{data:s}=await V.get("/user/cart");a.value=s.result}catch(s){console.log(s),x({text:((f=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:f.message)||"發生錯誤",snackbarProps:{color:"#D78A24"}})}};q();const W=N(()=>a.value.reduce((l,f)=>l+f.quantity*f.p_id.price,0)),D=N(()=>a.value.length>0&&!a.value.some(l=>!l.p_id.sell)),c=b(!1),k=async()=>{c.value=!0;const l=await i.checkout();x({text:l.text,snackbarProps:{color:l.color}}),l.color==="#3C5D44"&&y.push("/"),c.value=!1},o=async(l,f)=>{const s=await i.addCart(l,f);if(x({text:s.text,snackbarProps:{color:s.color}}),s.color==="#3C5D44"){const S=a.value.findIndex(Z=>Z.p_id._id===l);a.value[S].quantity+=f,a.value[S].quantity<=0&&a.value.splice(S,1)}},g=async()=>{try{const l=await V.post("/user/calculate-totalSpent");if(l.data.success)r.value=l.data.totalSpent,m.value=l.data.totalPoints,await i.profile();else throw new Error("更新使用者累積消費、累積點數失敗")}catch(l){console.log(l),console.error("更新使用者累積消費、累積點數失敗",l)}};return H(()=>{q(),g()}),(l,f)=>(n(),j(J,null,{default:e(()=>[t(M,{class:"mb-6"},{default:e(()=>[t($,{cols:"12",md:"12",lg:"12"},{default:e(()=>[t(T,{class:"text-center justify-center py-6"},{default:e(()=>[t(tt,{src:lt,alt:"Member Card",height:"380px"}),t(K,null,{default:e(()=>[h(" 玉食堂貴賓會員卡 ")]),_:1}),t(X,null,{default:e(()=>[h(" 累積消費："+d(A(i).totalSpent)+"元 ",1)]),_:1}),t(X,null,{default:e(()=>[h(" 累積點數："+d(A(i).totalPoint)+"點 ",1)]),_:1})]),_:1})]),_:1}),t($,{cols:"12",md:"12",lg:"12"},{default:e(()=>[t(T,{class:"text-center justify-center py-6"},{default:e(()=>[t(K,null,{default:e(()=>[h("會員資料")]),_:1}),t(et,null,{default:e(()=>[_("p",null,"會員帳號: "+d(A(i).account),1),_("p",null,"電話: "+d(A(i).phoneNumber),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(at,{modelValue:v.value,"onUpdate:modelValue":f[0]||(f[0]=s=>v.value=s),color:"#3C5D44",grow:""},{default:e(()=>[t(P,{value:1},{default:e(()=>[t(z,{icon:"mdi-rice"}),ht]),_:1}),t(P,{value:2},{default:e(()=>[t(z,{icon:"mdi-chef-hat"}),vt]),_:1}),t(P,{value:3},{default:e(()=>[t(z,{icon:"mdi-view-list"}),xt]),_:1}),t(P,{value:4},{default:e(()=>[t(z,{icon:"mdi-view-list"}),Ct]),_:1})]),_:1},8,["modelValue"]),t(st,{modelValue:v.value,"onUpdate:modelValue":f[1]||(f[1]=s=>v.value=s)},{default:e(()=>[t(I,{value:1},{default:e(()=>[t(T,null,{default:e(()=>[t(B,{cols:"12",class:"ma-5 text-center"},{default:e(()=>[bt]),_:1}),t(O,{items:a.value,headers:p},{"item.p_id.name":e(({item:s})=>[s.p_id.sell?(n(),u("span",Vt,d(s.p_id.name),1)):(n(),u("span",gt,d(s.p_id.name)+" (已下架)",1))]),"item.customized":e(({item:s})=>[_("ul",null,[s.customizations.加辣?(n(),u("li",wt,"辣度: "+d(s.customizations.加辣),1)):C("",!0),s.customizations["加蛋 +15"]==="true"?(n(),u("li",St,"加蛋 +15")):C("",!0),s.customizations["加飯 +15"]==="true"?(n(),u("li",$t,"加飯 +15")):C("",!0),s.customizations["加沙茶 +15"]==="true"?(n(),u("li",qt,"加沙茶 +15")):C("",!0),s.customizations["加料 +45"]==="true"?(n(),u("li",Dt,"加料 +45")):C("",!0)])]),"item.quantity":e(({item:s})=>[t(w,{variant:"text",color:"red",onClick:S=>o(s.p_id._id,-1)},{default:e(()=>[h("-")]),_:2},1032,["onClick"]),_("span",null,d(s.quantity),1),t(w,{variant:"text",color:"green",onClick:S=>o(s.p_id._id,1)},{default:e(()=>[h("+")]),_:2},1032,["onClick"])]),"item.action":e(({item:s})=>[t(w,{variant:"text",color:"#D78A24",icon:"mdi-delete",onClick:S=>o(s.p_id._id,s.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),t(B,{class:"ma-5 text-center"},{default:e(()=>[_("p",null,"總金額: "+d(W.value),1),t(w,{color:"#3C5D44",disabled:!D.value,onClick:k},{default:e(()=>[h("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}),t(I,{value:2},{default:e(()=>[t(kt)]),_:1}),t(I,{value:3},{default:e(()=>[t(dt)]),_:1}),t(I,{value:4},{default:e(()=>[t(pt)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{jt as default};
