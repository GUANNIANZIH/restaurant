import{_ as W,a0 as Y,r as n,o as Z,f as j,d as t,w as s,a5 as z,F as G,a6 as J,V as m,X as F,aL as v,aQ as h,aR as ee,e as o,aN as ae,aK as te,Y as le,a3 as oe,a4 as se,Z as re,$ as ue,W as ne}from"./index-tnzIr2VH.js";import{c as ie,a as B,f as de,e as L,u as me,d as p,V as ve}from"./vee-validate.esm-y9EK1Bpt.js";import{b as M}from"./route-block-B_A1xBdJ.js";import{V as pe,a as w}from"./VCol-Cwv4e_q3.js";import{V as ce}from"./VRow-BeY0Wjvy.js";import{V as ge}from"./VDataTableServer-jFkUlNsM.js";import{V as fe}from"./VSelect-BcqLxBb3.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-CKBjjZVF.js";import"./VPagination-Cuxj8YD9.js";import"./VDivider-DTQNOPFI.js";import"./VList-qUjOs-Px.js";import"./ssrBoot-B-xPYqUY.js";import"./VSlideGroup-BMHlfvAS.js";const Ve=c=>(re("data-v-f3d8da1b"),c=c(),ue(),c),ye=Ve(()=>ne("h1",{class:"text-center text-cus"},"玉食堂營收登記",-1)),R={__name:"revenue",setup(c){const{apiAuth:g}=J(),d=Y(),r=n({open:!1,id:""}),P=l=>{l?(r.value.id=l._id,f.value.value=l.itemName,V.value.value=l.date,y.value.value=l.quantity,b.value.value=l.typeField,x.value.value=l.totalAmount):r.value.id="",r.value.open=!0},U=()=>{r.value.open=!1,H()},q=[{text:"當日營業額收入",value:"當日營業額收入"},{text:"當日進貨支出",value:"當日進貨支出"},{text:"當日其他支出",value:"當日其他支出"},{text:"當日其他收入",value:"當日其他收入"},{text:"當日開店本金",value:"當日開店本金"}],O=ie({itemName:B().required("登記項目名稱必填"),date:de().required("交易日期必填"),quantity:L().min(1,"商品數量不得小於1").required("項目數量必填"),typeField:B().oneOf(q.map(l=>l.value),"交易類型必填"),totalAmount:L().test("valid-amount","總金額錯誤",function(l){const{typeField:e}=this.parent;return["REVENUE","OTHER_INCOME"].includes(e)?l>=0:["PURCHASE_EXPENSE","OTHER_EXPENSE","INITIAL_CAPITAL"].includes(e)?l<=0:!0}).required("總金額必填")}),{handleSubmit:_,isSubmitting:N,resetForm:H}=me({validationSchema:O,initialValues:{itemName:"",date:"",quantity:0,typeField:"",totalAmount:0}}),f=p("itemName"),V=p("date"),y=p("quantity"),b=p("typeField"),x=p("totalAmount"),K=_(async l=>{var e;try{r.value.id===""?await g.post("/revenue",l):await g.patch("/revenue/"+r.value.id,l),d({text:r.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"#D78A24"}}),U(),u(!0)}catch(a){d({text:((e=a.response)==null?void 0:e.data.message)||"發生錯誤",color:"error"})}}),X=async l=>{var e;try{await g.delete(`/revenue/${l._id}`),d({text:"營收項目已刪除",color:"success"}),u(!0)}catch(a){d({text:((e=a.response)==null?void 0:e.data.message)||"刪除失敗",color:"error"})}},E=n(),k=n([{key:"date",order:"desc"}]),C=n(1),I=n([]),D=n(0),$=n(!1),S=n(""),Q=[{title:"登記項目名稱",align:"center",sortable:!1,key:"itemName"},{title:"交易日期",align:"center",sortable:!0,key:"date",value:l=>new Date(l.createdAt).toLocaleString()},{title:"進貨數量",align:"center",sortable:!0,key:"quantity"},{title:"交易類型",align:"center",sortable:!0,key:"typeField"},{title:"總金額",align:"center",sortable:!0,key:"totalAmount"},{title:"操作",align:"center",sortable:!1,key:"action"}],u=async l=>{var e,a,A,T;console.log("Function executed"),l&&(C.value=1),$.value=!0;try{const{data:i}=await g.get("/revenue/all",{params:{page:C.value,itemsPerPage:E.value,sortBy:((e=k.value[0])==null?void 0:e.key)||"date",sortOrder:((a=k.value[0])==null?void 0:a.order)||"desc",search:S.value}});I.value.splice(0,I.value.length,...i.result.data),D.value=i.result.total}catch(i){console.log(i),d({text:((T=(A=i==null?void 0:i.response)==null?void 0:A.data)==null?void 0:T.message)||"發生錯誤",snackbarProps:{color:"red"}})}$.value=!1};return u(),(l,e)=>(Z(),j(G,null,[t(pe,null,{default:s(()=>[t(ce,null,{default:s(()=>[t(w,{cols:"12"},{default:s(()=>[ye]),_:1}),t(w,{cols:"12"},{default:s(()=>[t(m,{color:"#3C5D44",onClick:e[0]||(e[0]=a=>P(null))},{default:s(()=>[F("新增營收項目")]),_:1})]),_:1}),t(w,{cols:"12"},{default:s(()=>[t(ge,{"items-per-page":E.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>E.value=a),e[7]||(e[7]=a=>u(!1))],"sort-by":k.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>k.value=a),e[8]||(e[8]=a=>u(!1))],page:C.value,"onUpdate:page":[e[6]||(e[6]=a=>C.value=a),e[9]||(e[9]=a=>u(!1))],items:I.value,headers:Q,loading:$.value,"items-length":D.value,search:S.value,hover:""},{top:s(()=>[t(v,{label:"搜尋",modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),"append-icon":"mdi-magnify",onClickAppend:e[2]||(e[2]=a=>u(!0)),onKeydown:e[3]||(e[3]=h(a=>u(!0),["enter"]))},null,8,["modelValue"])]),"item.action":s(({item:a})=>[t(m,{icon:"mdi-pencil",variant:"text",color:"#3C5D44",onClick:A=>P(a)},null,8,["onClick"]),t(m,{icon:"mdi-delete",variant:"text",color:"#D78A24",onClick:A=>X(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(z,{modelValue:r.value.open,"onUpdate:modelValue":e[15]||(e[15]=a=>r.value.open=a),persistent:"",width:"500"},{default:s(()=>[t(ve,{onSubmit:ee(o(K),["prevent"]),disabled:o(N)},{default:s(()=>[t(ae,null,{default:s(()=>[t(te,null,{default:s(()=>[F(le(r.value.id?"編輯營收項目":"新增營收項目"),1)]),_:1}),t(oe,null,{default:s(()=>[t(v,{label:"登記項目名稱",modelValue:o(f).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>o(f).value.value=a),"error-messages":o(f).errorMessage.value},null,8,["modelValue","error-messages"]),t(v,{label:"交易日期",type:"date",modelValue:o(V).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>o(V).value.value=a),"error-messages":o(V).errorMessage.value},null,8,["modelValue","error-messages"]),t(v,{label:"進貨數量",type:"number",modelValue:o(y).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>o(y).value.value=a),"error-messages":o(y).errorMessage.value},null,8,["modelValue","error-messages"]),t(fe,{label:"交易類型",items:q,"item-title":"text","item-value":"value",modelValue:o(b).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>o(b).value.value=a),"error-messages":o(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(v,{label:"總金額",type:"number",modelValue:o(x).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>o(x).value.value=a),"error-messages":o(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(se,null,{default:s(()=>[t(m,{color:"red",loading:o(N),onClick:U},{default:s(()=>[F("取消")]),_:1},8,["loading"]),t(m,{color:"green",type:"submit",loading:o(N)},{default:s(()=>[F("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64))}};typeof M=="function"&&M(R);const qe=W(R,[["__scopeId","data-v-f3d8da1b"]]);export{qe as default};
