import{a0 as B,u as L,r as b,o as n,b as j,w as e,d as t,W as _,f as u,F as M,g as Y,X as v,Y as d,a9 as C,a6 as U,b5 as G,c as T,a2 as H,V as S,aN as I,as as tt,aK as K,aO as X,e as D,a3 as et,J as z}from"./index-DwXgdl5W.js";import{V as R}from"./VRow-Cqg4UXo3.js";import{a as A,V as J}from"./VCol-BuFbBn21.js";import{V as Q}from"./VDivider-B1HlkWpQ.js";import{V as F}from"./VDataTable-BAEpweM5.js";import{V as N}from"./VSheet-zvEGpTJt.js";import{a as P,V as at,c as E,b as st}from"./VTabs-CTKJhl0H.js";import"./VPagination-CW3oj08K.js";import"./VSelect-CCi-U2KC.js";import"./VList-DeJg5qEL.js";import"./ssrBoot-Bli6wJBR.js";import"./VSlideGroup-DNmrCLzY.js";import"./VWindowItem-C1nNOg3d.js";const lt="/assets/%E7%8E%89%E9%A3%9F%E5%A0%82%E6%9C%83%E5%93%A1%E5%8D%A1-6bfaCLpA.png",ot=_("h2",{class:"text-center"},"我的訂單查詢",-1),nt={key:0},ct={key:1},it={key:2},rt={key:3},ut={key:4},dt={__name:"profileOrder_dataTable",setup(O){const{apiAuth:h}=U(),V=B();L();const y=b([]),x=[{title:"編號",key:"_id"},{title:"日期",key:"createdAt",value:r=>new Date(r.createdAt).toLocaleString()},{title:"商品",key:"cart",sortable:!1},{title:"金額",key:"price",value:r=>r.cart.reduce((m,a)=>m+a.quantity*a.p_id.price,0)}];return(async()=>{var r,m;try{const{data:a}=await h.get("/order");if(a.success)y.value.push(...a.result);else throw new Error(a.message||"無法加載訂單資料")}catch(a){console.error("Error loading orders:",{message:a.message,stack:a.stack,response:a.response}),V({text:((m=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:m.message)||"發生錯誤，無法加載訂單資料",snackbarProps:{color:"red"}})}})(),(r,m)=>(n(),j(J,null,{default:e(()=>[t(R,null,{default:e(()=>[t(A,{cols:"12"},{default:e(()=>[ot]),_:1}),t(Q),t(A,{cols:"12"},{default:e(()=>[t(F,{items:y.value,headers:x},{"item.cart":e(a=>[_("ul",null,[(n(!0),u(M,null,Y(a.item.cart,p=>(n(),u("li",{key:p._id},[v(d(p.p_id.name)+" * "+d(p.quantity)+" ",1),_("ul",null,[p.customizations.加辣?(n(),u("li",nt,"辣度: "+d(p.customizations.加辣),1)):C("",!0),p.customizations["加蛋 +15"]==="true"?(n(),u("li",ct,"加蛋 +15")):C("",!0),p.customizations["加飯 +15"]==="true"?(n(),u("li",it,"加飯 +15")):C("",!0),p.customizations["加沙茶 +15"]==="true"?(n(),u("li",rt,"加沙茶 +15")):C("",!0),p.customizations["加料 +45"]==="true"?(n(),u("li",ut,"加料 +45")):C("",!0)])]))),128))])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}))}},_t=_("h2",{class:"text-center"},"我的私廚訂單查詢",-1),pt={__name:"profileOrderSpecialty_dataTable",setup(O){const{apiAuth:h}=U(),V=B();L();const y=b([]),x=[{title:"編號",key:"_id"},{title:"日期",key:"createdAt",value:r=>new Date(r.createdAt).toLocaleString()},{title:"商品",key:"cartSpecialties",sortable:!1},{title:"金額",key:"price",value:r=>r.cartSpecialties.reduce((m,a)=>m+a.quantity*a.p_id.price,0)}];return(async()=>{var r,m;try{const{data:a}=await h.get("/order/specialty");y.value.push(...a.result)}catch(a){console.log(a),V({text:((m=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:m.message)||"發生錯誤",snackbarProps:{color:"red"}})}})(),(r,m)=>(n(),j(J,null,{default:e(()=>[t(R,null,{default:e(()=>[t(A,{cols:"12"},{default:e(()=>[_t]),_:1}),t(Q),t(A,{cols:"12"},{default:e(()=>[t(F,{items:y.value,headers:x},{"item.cartSpecialties":e(a=>[_("ul",null,[(n(!0),u(M,null,Y(a.item.cartSpecialties,p=>(n(),u("li",{key:p._id},d(p.p_id.name)+" * "+d(p.quantity),1))),128))])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}))}},mt=_("h2",{class:"text-center"},"我的預購私廚購物車",-1),ft={key:0},yt={key:1,class:"text-red"},kt={__name:"cartSpecialty",setup(O){const{apiAuth:h}=U(),V=G(),y=B(),x=L(),i=b([]),r=[{title:"品名",key:"p_id.name"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:c=>c.p_id.price*c.quantity},{title:"操作",key:"action"}],m=async()=>{var c,k;try{const{data:o}=await h.get("/user/cartSpecialty");i.value=o.result}catch(o){console.log(o),y({text:((k=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:k.message)||"發生錯誤",snackbarProps:{color:"#D78A24"}})}};m();const a=T(()=>i.value.reduce((c,k)=>c+k.quantity*k.p_id.price,0)),p=T(()=>i.value.length>0&&!i.value.some(c=>!c.p_id.sell)),$=b(!1),W=async()=>{$.value=!0;const c=await x.checkoutSpecialty();y({text:c.text,snackbarProps:{color:c.color}}),c.color==="#3C5D44"&&V.push("/"),$.value=!1},q=async(c,k)=>{const o=await x.addSpecialtyCart(c,k);if(y({text:o.text,snackbarProps:{color:o.color}}),o.color==="#3C5D44"){const g=i.value.findIndex(l=>l.p_id._id===c);i.value[g].quantity+=k,i.value[g].quantity<=0&&i.value.splice(g,1)}};return H(()=>{m()}),(c,k)=>(n(),u(M,null,[t(I,null,{default:e(()=>[t(N,{cols:"12",class:"ma-5 text-center"},{default:e(()=>[mt]),_:1}),t(F,{items:i.value,headers:r},{"item.p_id.name":e(({item:o})=>[o.p_id.sell?(n(),u("span",ft,d(o.p_id.name),1)):(n(),u("span",yt,d(o.p_id.name)+" (已下架)",1))]),"item.quantity":e(({item:o})=>[t(S,{variant:"text",color:"red",onClick:g=>q(o.p_id._id,-1)},{default:e(()=>[v("-")]),_:2},1032,["onClick"]),_("span",null,d(o.quantity),1),t(S,{variant:"text",color:"green",onClick:g=>q(o.p_id._id,1)},{default:e(()=>[v("+")]),_:2},1032,["onClick"])]),"item.action":e(({item:o})=>[t(S,{variant:"text",color:"#D78A24",icon:"mdi-delete",onClick:g=>q(o.p_id._id,o.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),t(N,{class:"ma-5 text-center"},{default:e(()=>[_("p",null,"總金額: "+d(a.value),1),t(S,{color:"#3C5D44",disabled:!p.value,onClick:W},{default:e(()=>[v("結帳")]),_:1},8,["disabled"])]),_:1})],64))}},vt=_("span",null,"即時餐點購物車",-1),ht=_("span",null,"預購私廚購物車",-1),xt=_("span",null,"即時餐點訂單查詢",-1),Ct=_("span",null,"私廚訂單查詢",-1),bt=_("h2",{class:"text-center"},"我的即時餐點購物車",-1),Vt={key:0},gt={key:1,class:"text-red"},St={key:0},wt={key:1},At={key:2},$t={key:3},qt={key:4},jt={__name:"profile",setup(O){const h=b(1),{apiAuth:V}=U(),y=G(),x=B(),i=L(),r=b(0),m=b(0),a=b([]),p=[{title:"品名",key:"p_id.name"},{title:"客製化需求",key:"customized"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:l=>l.p_id.price*l.quantity},{title:"操作",key:"action"}],$=async()=>{var l,f;try{const{data:s}=await V.get("/user/cart");a.value=s.result}catch(s){console.log(s),x({text:((f=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:f.message)||"發生錯誤",snackbarProps:{color:"#D78A24"}})}};$();const W=T(()=>a.value.reduce((l,f)=>l+f.quantity*f.p_id.price,0)),q=T(()=>a.value.length>0&&!a.value.some(l=>!l.p_id.sell)),c=b(!1),k=async()=>{c.value=!0;const l=await i.checkout();x({text:l.text,snackbarProps:{color:l.color}}),l.color==="#3C5D44"&&y.push("/"),c.value=!1},o=async(l,f)=>{const s=await i.addCart(l,f);if(x({text:s.text,snackbarProps:{color:s.color}}),s.color==="#3C5D44"){const w=a.value.findIndex(Z=>Z.p_id._id===l);a.value[w].quantity+=f,a.value[w].quantity<=0&&a.value.splice(w,1)}},g=async()=>{try{const l=await V.post("/user/calculate-totalSpent");if(l.data.success)r.value=l.data.totalSpent,m.value=l.data.totalPoints,await i.profile();else throw new Error("更新使用者累積消費、累積點數失敗")}catch(l){console.log(l),console.error("更新使用者累積消費、累積點數失敗",l)}};return H(()=>{$(),g()}),(l,f)=>(n(),j(J,null,{default:e(()=>[t(R,{class:"mb-6"},{default:e(()=>[t(A,{cols:"12",md:"12",lg:"12"},{default:e(()=>[t(I,{class:"text-center justify-center py-6"},{default:e(()=>[t(tt,{src:lt,alt:"Member Card",height:"380px"}),t(K,null,{default:e(()=>[v(" 玉食堂貴賓會員卡 ")]),_:1}),t(X,null,{default:e(()=>[v(" 累積消費："+d(D(i).totalSpent)+"元 ",1)]),_:1}),t(X,null,{default:e(()=>[v(" 累積點數："+d(D(i).totalPoint)+"點 ",1)]),_:1})]),_:1})]),_:1}),t(A,{cols:"12",md:"12",lg:"12"},{default:e(()=>[t(I,{class:"text-center justify-center py-6"},{default:e(()=>[t(K,null,{default:e(()=>[v("會員資料")]),_:1}),t(et,null,{default:e(()=>[_("p",null,"會員帳號: "+d(D(i).account),1),_("p",null,"電話: "+d(D(i).phoneNumber),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(at,{modelValue:h.value,"onUpdate:modelValue":f[0]||(f[0]=s=>h.value=s),color:"#3C5D44",grow:""},{default:e(()=>[t(P,{value:1},{default:e(()=>[t(z,{icon:"mdi-rice"}),vt]),_:1}),t(P,{value:2},{default:e(()=>[t(z,{icon:"mdi-chef-hat"}),ht]),_:1}),t(P,{value:3},{default:e(()=>[t(z,{icon:"mdi-view-list"}),xt]),_:1}),t(P,{value:4},{default:e(()=>[t(z,{icon:"mdi-view-list"}),Ct]),_:1})]),_:1},8,["modelValue"]),t(st,{modelValue:h.value,"onUpdate:modelValue":f[1]||(f[1]=s=>h.value=s)},{default:e(()=>[t(E,{value:1},{default:e(()=>[t(I,null,{default:e(()=>[t(N,{cols:"12",class:"ma-5 text-center"},{default:e(()=>[bt]),_:1}),t(F,{items:a.value,headers:p},{"item.p_id.name":e(({item:s})=>[s.p_id.sell?(n(),u("span",Vt,d(s.p_id.name),1)):(n(),u("span",gt,d(s.p_id.name)+" (已下架)",1))]),"item.customized":e(({item:s})=>[_("ul",null,[s.customizations.加辣?(n(),u("li",St,"辣度: "+d(s.customizations.加辣),1)):C("",!0),s.customizations["加蛋 +15"]==="true"?(n(),u("li",wt,"加蛋 +15")):C("",!0),s.customizations["加飯 +15"]==="true"?(n(),u("li",At,"加飯 +15")):C("",!0),s.customizations["加沙茶 +15"]==="true"?(n(),u("li",$t,"加沙茶 +15")):C("",!0),s.customizations["加料 +45"]==="true"?(n(),u("li",qt,"加料 +45")):C("",!0)])]),"item.quantity":e(({item:s})=>[t(S,{variant:"text",color:"red",onClick:w=>o(s.p_id._id,-1)},{default:e(()=>[v("-")]),_:2},1032,["onClick"]),_("span",null,d(s.quantity),1),t(S,{variant:"text",color:"green",onClick:w=>o(s.p_id._id,1)},{default:e(()=>[v("+")]),_:2},1032,["onClick"])]),"item.action":e(({item:s})=>[t(S,{variant:"text",color:"#D78A24",icon:"mdi-delete",onClick:w=>o(s.p_id._id,s.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),t(N,{class:"ma-5 text-center"},{default:e(()=>[_("p",null,"總金額: "+d(W.value),1),t(S,{color:"#3C5D44",disabled:!q.value,onClick:k},{default:e(()=>[v("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}),t(E,{value:2},{default:e(()=>[t(kt)]),_:1}),t(E,{value:3},{default:e(()=>[t(dt)]),_:1}),t(E,{value:4},{default:e(()=>[t(pt)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{jt as default};
